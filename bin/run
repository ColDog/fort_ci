#!/usr/bin/env ruby

require "bundler/setup"
require "fort_ci"

cmd = ARGV[0]

if cmd == "migrate"
  require "sequel"
  Sequel.extension :migration
  # TODO: How will this work when the gem is deployed somewhere else?
  Sequel::Migrator.run(FortCI::DB, "lib/fort_ci/migrations")
elsif cmd == "work"
  FortCI::Worker.executor.run
elsif cmd == "serve"
  Rack::Handler.default.run FortCI::App.new, Port: 3000, Bind: '0.0.0.0'
else
  puts "command not recognized: #{cmd}"
end
